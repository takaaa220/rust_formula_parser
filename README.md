# Formula Parser

文字列で与えられた数式を解析して、結果を計算するプログラム。Rust の勉強用に作成しているだけであり、本番利用を想定したものではない。

## サポートしている数式

- 算術演算子
- 比較演算子
- 関数
- 変数

### 算術演算子

以下の算術演算子をサポートしている。

- `+`
- `-`
- `*`
- `/`
- `%`

例:

```rust
parse_formula("(1 + 2) * 3", vec![], vec![]) // → 9
parse_formula("(1 * -2) + (-3)", vec![], vec![]) // → -5
```

### 比較演算子

以下の比較演算子をサポートしている。論理値は存在せず、結果は 1 と 0 で表現される。

- `==`
- `!=`
- `>`
- `>=`
- `<`
- `<=`

例:

```rust
parse_formula("1 == 1", vec![], vec![]) // → 1.0
parse_formula("1 != 1", vec![], vec![]) // → 0.0
parse_formula("1 == 1 > 0", vec![], vec![]) // → 1.0
```

### 関数

以下の関数をデフォルトでサポートしている。

引数で任意の関数を渡す事ができるようになっており、関数名は 1 文字目が大文字、2 文字目以降は小文字・大文字のいずれかが使用できる。

- `Add(a1, a2)`
- `Sub(a1, a2)`
- `Div(a1, a2)`
- `Mul(a1, a2)`
- `Mod(a1, a2)`
- `If(a1 == a2, a3, a4)`

例:

```rust
parse_formula("Add(2, 3) + 3", vec![], vec![]) // → 8.0
parse_formula(
  "Pow(2, 3) + 3",
  vec![Function::new("Pow", 2, |args| args[0].powf(args[1]))],
  vec![]
) // → 11.0
```

### 変数

引数で任意の引数とその値を渡すことができる。変数名は 1 文字目が小文字、2 文字目以降は小文字・大文字のいずれかが使用できる。

例:

```rust
parse_formula(
  "hoge + 3",
  vec![],
  vec![Variable::new("hoge", 5.0)]
) // → 8.0
```

## アーキテクチャ

<!-- TODO: 細かく書く -->

大まかに以下の順に処理が行われる。

1. 文字列をトークンに変換 (Lexer)
2. トークンを走査し、中間表現 (逆ポーランド記法) に変換 (Parser)
3. 中間表現の評価 (Processor)
